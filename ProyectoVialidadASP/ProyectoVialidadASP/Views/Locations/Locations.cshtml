
@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Añadir Nuevo Parqueo</title>
    <link rel="stylesheet" href="~/Style/StyleIndex/SLocations.css">
    <!-- GOOGLE FONTs -->
    <link href="https://fonts.googleapis.com/css?family=Quicksand" rel="stylesheet">
    <!-- FONT AWESOME -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">
    <!-- ANIMATE CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.0/animate.min.css">
</head>
<body>
    <form action="/Locations/Locations" method="post" enctype="multipart/form-data">
        <section>
            <div class="container">
                <h2>Añadir Nuevo Parqueo</h2>
                <div class="row100">
                    <div class="col">
                        <div class="inputBox">
                            <input type="text" name="name" id="name" required>
                            <span class="text">Nombre del Parqueo</span>
                            <span class="line"></span>
                        </div>
                    </div>
                    <div class="col">
                        <div class="inputBox">
                            <input type="text" name="nameStreet" id="nameStreet" required>
                            <span class="text">Nombres de las calles</span>
                            <span class="line"></span>
                        </div>
                    </div>

                </div>
                <h3>Punto Inicio</h3>
                <div class="row100">
                    <div class="col">
                        <div class="inputBox">
                            <input type="number" name="latitude" minlength="9" maxlength="10" id="latitude" step="0.000000000000001" required readonly>
                            <span class="text tdisabled" >Latitud</span>
                            <span class="line ldisabled" ></span>
                        </div>
                    </div>
                    <div class="col">
                        <div class="inputBox">
                            <input type="number" name="lenght" minlength="9" maxlength="10" id="lenght" step="0.000000000000001" required readonly>
                            <span class="text tdisabled">Longitud</span>
                            <span class="line ldisabled"></span>
                        </div>
                    </div>
                </div>
                <div id="dataTwo" style="display:none">
                    <h3>Punto Final</h3>
                    <div class="row100">
                        <div class="col">
                            <div class="inputBox">
                                <input type="number" name="latitudeTwo" minlength="9" maxlength="10" id="latitudeTwo" step="0.000000000000001"  readonly>
                                <span class="text tdisabled">Latitud</span>
                                <span class="line ldisabled"></span>
                            </div>
                        </div>
                        <div class="col">
                            <div class="inputBox" >
                                <input type="number" name="lenghtTwo" minlength="9" maxlength="10" id="lenghtTwo" step="0.000000000000001"  readonly>
                                <span class="text tdisabled">Longitud</span>
                                <span class="line ldisabled"></span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="row100">
                    <div class="col">
                        <div>
                            <div style="width: 100%; height: 50vh;" id="map"></div>
                        </div>
                    </div>
                </div>
                <div class="row100">
                    <div class="col">
                        <div class="inputBox text">
                            <select id="Select" style="width:100%;padding:10px 20px;outline:none;font-size:15px;" onchange="seleccionar()" name="Select">
                                <option id="one" value="No Tarifado" selected>No Tarifado</option>
                                <option id="two" value="Tarifado">Tarifado</option>
                            </select>
                            <span class="text tdisabled">Tipo</span>

                        </div>
                    </div>
                    <div class="col">
                        <div class="inputBox">
                            <input type="number" name="parkingSpaces" minlength="2" maxlength="3" id="parkingSpaces" required>
                            <span class="text">Espacios</span>
                            <span class="line"></span>
                        </div>
                    </div>

                </div>
                <div class="row100">
                    <div class="col">
                        <div class="inputBox textarea">
                            <textarea required id="description" name="description"></textarea>
                            <span class="text">Descripción</span>
                            <span class="line"></span>
                        </div>
                    </div>
                    <div class="col" id="DataPrice" style="display:none">
                        <div class="inputBox">
                            <input type="number" name="price" minlength="4" maxlength="5" id="price" step="0.01" >
                            <span class="text">Tarifas</span>
                            <span class="line"></span>
                        </div>
                    </div>
                    
                </div><br />
                <h3>Imagen del Parqueo</h3>
                <div class="row100">
                    <div class="col cadImage">
                        <div class="inputBox text ">
                            <input type="file" name="file" accept="image/png,image/jpeg,image/jpg" id="file" hidden onchange="vista_preliminar(event)" required>
                            <label for="file" id="selector">Seleccionar Imagen del Parqueo</label>
                            <br>
                            <img class="imgWhite" src="~/Imagen/ImgHome/Image.png" alt="" id="imgFoto">
                        </div>
                    </div>
                </div><br />
                <h3>Imagen de la calle no disponible</h3>
                <div class="row100">
                    <div class="col cadImage">
                        <div class="inputBox text ">
                            <input type="file" name="fileDesign" accept="image/png,image/jpeg,image/jpg" id="croquis" hidden onchange="vista_preliminarCroquis(event)" required>
                            <label for="croquis" id="selectorCroquis">Seleccionar Imagen de la calle no disponible</label>
                            <br>
                            <img class="imgWhite" src="~/Imagen/ImgHome/Image.png" alt="" id="imgFotoCroquis">
                        </div>
                    </div>
                </div>
                <div class="row100">
                    <div class="col ">
                        <div class="colb">
                            <input type="submit" value="Añadir">
                            <a class="btnC" href="/Locations/LocationsList">Cancelar</a>
                        </div>

                    </div>

                </div>

            </div>
        </section>
    </form>
    <script src="~/Js/ValidacionLocation.js"></script>
    <script async
            src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBtFqDJ3PeclA4FbDx9-uYvhil8NV1Mu7E&callback=initMap">
    </script>
    <script>
        //#region Mapa
        var marker;
        var dato;
        var coords = {};    

        initMap = function () {

            navigator.geolocation.getCurrentPosition(
                function (position) {
                    coords = {
                        lng: -66.155439,
                        lat: -17.392097
                    };
                    setMapa(coords);  
                }, function (error) { console.log(error); });

        }
        
        function seleccionar() {
            let Select = document.getElementById('Select');
            dato = Select.value;
            document.getElementById("latitude").value = -17.392097;
            document.getElementById("lenght").value = -66.155439;
            document.getElementById("latitudeTwo").value = -17.390810;
            document.getElementById("lenghtTwo").value = -66.141201;
            var dataTwo = document.getElementById("dataTwo");
            var price = document.getElementById("DataPrice");
            
            setMapa(coords);
            if (dato == 'No Tarifado') {
                dataTwo.style.display = "none";
                price.style.display = "none";
            } else {
                dataTwo.style.display = "block";
                price.style.display = "block";
            }
        }

        function setMapa(coords) {
            var map = new google.maps.Map(document.getElementById('map'),
                {
                    zoom: 13,
                    center: new google.maps.LatLng(coords.lat, coords.lng),

                });

            marker = new google.maps.Marker({
                map: map,
                draggable: true,
                animation: google.maps.Animation.DROP,
                position: new google.maps.LatLng(coords.lat, coords.lng),

            });

            marker.addListener('click');
            if (dato == 'Tarifado') {
                var initialMarker = { lat: Number(document.getElementById("latitude").value), lng: Number(document.getElementById("lenght").value) };
                var finalMarker = { lat: Number(document.getElementById("latitudeTwo").value), lng: Number(document.getElementById("lenghtTwo").value) };
                var line = new google.maps.Polyline();
            }
            marker.addListener('dragend', function (event) {
                document.getElementById("latitude").value = this.getPosition().lat();
                document.getElementById("lenght").value = this.getPosition().lng();
                if (dato == 'Tarifado') {
                    var initialMarker = { lat: Number(document.getElementById("latitude").value), lng: Number(document.getElementById("lenght").value) };
                    var finalMarker = { lat: Number(document.getElementById("latitudeTwo").value), lng: Number(document.getElementById("lenghtTwo").value) };
                    line.setMap(null);
                    line = new google.maps.Polyline({ path: [initialMarker, finalMarker], map: map })
                }
                
            });

            ////

            if (dato=='Tarifado') {
                markerTwo = new google.maps.Marker({
                    map: map,
                    draggable: true,
                    animation: google.maps.Animation.DROP,
                    position: new google.maps.LatLng(-17.390810, -66.141201),

                });
                markerTwo.setIcon('/Imagen/endMarker.png')
                markerTwo.addListener('click');
                var initialMarker = { lat: Number(document.getElementById("latitude").value), lng: Number(document.getElementById("lenght").value) };
                var finalMarker = { lat: Number(document.getElementById("latitudeTwo").value), lng: Number(document.getElementById("lenghtTwo").value) };
                var line = new google.maps.Polyline({ path: [initialMarker, finalMarker], map: map });
                markerTwo.addListener('dragend', function (event) {
                    document.getElementById("latitudeTwo").value = this.getPosition().lat();
                    document.getElementById("lenghtTwo").value = this.getPosition().lng();
                    var initialMarker = { lat: Number(document.getElementById("latitude").value), lng: Number(document.getElementById("lenght").value) };
                    var finalMarker = { lat: Number(document.getElementById("latitudeTwo").value), lng: Number(document.getElementById("lenghtTwo").value) };
                    line.setMap(null);
                    line = new google.maps.Polyline({ path: [initialMarker, finalMarker], map: map })
                });
               
            }
            
        }

        //#endregion

        //#region parqueo
        var loader = function (e) {
            let file = e.target.files;
            let show = "" + file[0].name;
            let output = document.getElementById('selector');
            output.innerHTML = show;
            output.classList.add("active");
        };
        let fileInput = document.getElementById("file");
        fileInput.addEventListener("change", loader);
        let vista_preliminar = (event) => {
            let leer_img = new FileReader();
            let id_img = document.getElementById('imgFoto');

            leer_img.onload = () => {
                if (leer_img.readyState == 2) {
                    id_img.src = leer_img.result;
                }
            }
            leer_img.readAsDataURL(event.target.files[0])
        }
        //#endregion
        //#region Croquis
        var loaderC = function (e) {
            let file = e.target.files;
            let show = "" + file[0].name;
            let output = document.getElementById('selectorCroquis');
            output.innerHTML = show;
            output.classList.add("active");
        };
        let fileInputCroquis = document.getElementById("croquis");
        fileInputCroquis.addEventListener("change", loaderC);
        let vista_preliminarCroquis = (event) => {
            let leer_img = new FileReader();
            let id_img = document.getElementById('imgFotoCroquis');

            leer_img.onload = () => {
                if (leer_img.readyState == 2) {
                    id_img.src = leer_img.result;
                }
            }
            leer_img.readAsDataURL(event.target.files[0])
        }
            //#endregion
    </script>
</body>
</html>
